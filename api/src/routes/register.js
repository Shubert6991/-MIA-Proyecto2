const { query, response } = require('express');
const express = require('express');
const router = express.Router();
const db = require("../database");
const forge = require('node-forge');
const e = require('express');
var base64ImageToFile = require('base64image-to-file');

router.get('/getPaises', async(req,res) => {
  sql = "SELECT*FROM pais";

  let result = await db.Open(sql, [], false);
  Paises = [];

  result.rows.map(user => {
    let paisSchema = {
      "id": user[0],
      "nombre": user[1],
    }

    Paises.push(paisSchema);
  })

  res.json(Paises);
});

router.post('/registro',async(req,res) =>{
  let response = {"mensaje":"OK"};
  let picture = req.body.picture ? req.body.picture : "data:image/png;base64,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";
  var md = forge.md.sha256.create();
  md.update(req.body.password);
  let pass = md.digest().toHex();
  let picPath = `uploads/${req.body.email}`;
  let fullPath = "";
  base64ImageToFile(picture, picPath, 'profilePic', function(err, imgPath) {
    if(err) {
      console.log(err);
      response.mensaje = "ERROR, AL SUBIR FOTO";
      res.send(JSON.stringify(response));
      return;
    }
    fullPath = imgPath;
  });

  //verificar si ya existe un usuario con ese correo
  sqlVerification = `SELECT * FROM usuario WHERE correo = '${req.body.email}'`;
  let verfication = await db.Open(sqlVerification,[],false);
  if(verfication.rows.length > 0){
    response.mensaje = "ERROR, USUARIO YA EXISTE";
  } else {
    sqlRegistro = `INSERT INTO usuario(correo,nombre,apellido,contrasena,nacimiento,foto,creditos,tipo,pais_idPais) `+ 
        `VALUES ('${req.body.email}','${req.body.name}','${req.body.lastname}','${pass}',TO_DATE('${req.body.date}', 'DD/MM/YYYY'),'${fullPath}',10000,0,${req.body.country})`;
    let result = await db.Open(sqlRegistro,[],true);
    console.log(result);
    response.mensaje = "OK";
  }

  res.send(JSON.stringify(response));
});

module.exports = router;